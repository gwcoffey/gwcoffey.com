<!DOCTYPE html>
<html lang="en-us">
<head>
	<title>gwcoffey.com: Assemble Multi-Part Reports with FileMaker Pro 9</title>

    
    
    
    <link rel="stylesheet" href="/css/style.css">
    
	
	
	<script src="/js/main.js" defer></script>
</head>

<body>

<header>
	<h2><a rel="home" href="/">gwcoffey.com</a></h2>
</header>

<main>

<section class="archive">
	<h3>Archived Post</h3>
	
	<p>
		This post is archived from the now-defunct FileMaker Advisor magazine. Some posts have been edited slightly to fix typographical errors, and remove unnecessarily-gendered language. You can <a href="/archive/advisor/">view the full archive here</a>.
	</p>
	
</section>

<article>

<hgroup>
	<h1>Assemble Multi-Part Reports with FileMaker Pro 9</h1>
	<div class="byline">
		<address><a rel="author" href="/me">Geoff Coffey</a></address>
		/
		<time datetime="2007-09-10 00:00:00 &#43;0000 UTC">10 September 2007</time>
	</div>
</hgroup>

<p>FileMaker has some pretty powerful reporting tools. You can decorate your layouts any way you see fit, control which record show, in what order, and with any particular fields arranged to your liking. You can even summarize your data in numerous ways to produce totals, subtotals, and other aggregate analysis. But until FileMaker 9, there has been one glaring restriction: A report can only show records from one table. If you want to show new products on one page, and new customers on the next, you&rsquo;re out of luck. Of course you can just create two reports, and print them back to back. But that is an imperfect solution:</p>
<ol>
<li>
<p>If you&rsquo;re in a busy office, other print jobs can get mixed up with yours, and you&rsquo;ll have to reassemble your multi-part report by hand.</p>
</li>
<li>
<p>Even more significant, people often don&rsquo;t want paper anymore. Since version 8, FileMaker has had excellent PDF support, so you can take your beautiful reports digital. View them on screen, store them on the file server, and email them to your colleagues. But if your report is in several parts, you had to create different PDFs for each one. Yuck.</p>
</li>
</ol>
<h2 id="append-to-pdf">Append to PDF</h2>
<p>FileMaker 9 has a new, almost hidden feature called &ldquo;Append to PDF.&rdquo; It is only available in ScriptMaker, so you&rsquo;ll have to write a script to take advantage of it. Don&rsquo;t worry, though &ndash; this article will show you everything you need to know.</p>
<p>When your script creates a PDF, you can turn on the new &ldquo;Append to existing PDF&rdquo; checkbox (it shows up when you use the &ldquo;Save Records as PDF&rdquo; script step). With this option turned on, if you save the PDF in the same folder and with the same name as an existing PDF file on your hard drive, FileMaker doesn&rsquo;t replace that PDF. Instead, it adds pages from this new report to the end of it. When it&rsquo;s done, your existing PDF file has everything it had before, plus all the pages from your new report.</p>
<p>That&rsquo;s basically it. The concept is very simple. Now your job is to put all the pieces together.</p>
<p>ACME Widgets and More</p>
<p>Let&rsquo;s do a little visualization. You are a FileMaker developer working for a company called ACME Widgets and More. ACME sells stuff, and they&rsquo;ve asked you to give them a powerful new report. It will show important recap information about the previous week. They would like to see every new customer, along with how much they have ordered. They also want to see every product that sold in the last week, compared to the week before. Finally, they want an analysis of sales across all product categories.</p>
<p>You already have reports that do these things. But they want them in the inboxes of each executive every monday morning, as a nicely formatted PDF.</p>
<p>There&rsquo;s no reasonable way to produce a report like this with just one layout since each report comes from a different table. And since you already have the various reports, it would be a shame to recreate them all anyway. So instead, you&rsquo;ll use Append to PDF to assemble all three reports in one single PDF file. For good measure, you&rsquo;ll also add a nice cover sheet to the report. And then, once the big wigs see the awesome report, you&rsquo;ll enjoy your bonus in the Bahamas. Thank you, FileMaker.</p>
<p>!!!PRODUCTION NOTE: insert COFFG05A.tiff here!!!</p>
<p>Caption: You already have the reports. You just need to put a cover sheet on them and package them all together. This could be an all-day job of printing, collating, and stapling every Monday. But with Append to PDF you can script the entire process.</p>
<p>Getting Started</p>
<p>The basis of your script is really very simple:</p>
<ol>
<li>Go to the appropriate layout for the first page or pages.</li>
<li>Perform any appropriate finds, sorts, and so forth.</li>
<li>Save the report as a PDF</li>
<li>Go to the next layout</li>
<li>Rinse. Repeat.</li>
</ol>
<p>Your first task is to output the first page or pages of the report. The finding and sorting is up to you. But once you have what you want on the screen, add the Save Records as PDF script step to your script.</p>
<p>When you use this script step, you have two choices for where the PDF is saved, and what it is called. You can either hard-code a file path (by turning on the &ldquo;Specify output file&rdquo; checkbox) or you can leave this option off and let your user decide where to save. Many PDF generating scripts choose the latter option so the script doesn&rsquo;t have to know where the file should go.</p>
<p>But your script is going to run Save Records as PDF several times. You certainly don&rsquo;t want your user to have to deal with the Save As dialog box repeatedly while the report runs. So in this case, you should specify the output file location in the script.</p>
<p>!!!PRODUCTION NOTE: insert sidebar COFFG05B.txt here!!!</p>
<p>In addition to a fixed file location, you&rsquo;ll want to turn on the &ldquo;Perform without dialog&rdquo; and &ldquo;Specify options&rdquo; checkboxes for the Save Records as PDF script step. These setting ensure your user won&rsquo;t be pestered with dialog boxes as the report is assembled. But don&rsquo;t turn on &ldquo;Append to existing PDF&rdquo; for this step. You&rsquo;ll use that feature on the next section.</p>
<p>For now, when you turn on &ldquo;Specify options,&rdquo; just make sure &ldquo;Records being browsed&rdquo; is selected in the Save pop-up menu, then click  OK. We will revisit the advanced PDF options shortly.</p>
<p>At this point, your script might look something like Figure 2.</p>
<p>!!!PRODUCTION NOTE: insert COFFG05C.tiff here!!!</p>
<p>Caption: This script isn&rsquo;t all that earth shattering, but its the start of a powerful report. In this case, it goes to a special layout that shows a nice cover page, and sends that layout to a PDF on the user&rsquo;s desktop. This version of the script uses variables, which requires FileMaker Pro Advanced. If you only have the regular version of FileMaker Pro, just hard-code a file name and location and leave out the Set Variable step.</p>
<p>Appending to an Existing PDF</p>
<p>The next steps are almost identical to the last. Go to a layout, do your finds and sorts, and save as PDF. You&rsquo;ll make only one small change: When you add the Save Records as PDF step to your script, turn on its new &ldquo;Append to existing PDF&rdquo; checkbox (Figure 3). Since you&rsquo;re using the same path for the output file, FileMaker will find the PDF you created in the first part of the script and add pages to it.</p>
<p>!!!PRODUCTION NOTE: insert COFFG05D.tiff here!!!</p>
<p>Caption: See that little checkbox called &ldquo;Append to existing PDF?&rdquo; That&rsquo;s it. That&rsquo;s the new feature in FileMaker Pro 9. It doesn&rsquo;t look like much, but as you&rsquo;re finding out right now, it packs a lot of power.</p>
<p>Your complex report can have as many parts as you want. Just keep on calling Save Records as PDF, and make sure &ldquo;Append to existing PDF&rdquo; is turned on each time. Figure 4 shows a more complete script.</p>
<p>!!!PRODUCTION NOTE: insert COFFG05E.tiff here!!!</p>
<p>Caption: This script produces a single PDF from four different layouts. All the work of changing layouts and finding records is tucked away in subscripts. You only need to concern yourself with the four separate steps that save PDFs. Notice that the first Save Records as PDF step does not have the &ldquo;Append&rdquo; option turned on. It creates the initial PDF file (replacing any older version that might be there). The others then append to that one.</p>
<p>Fixing Page Numbers</p>
<p>If you have a script like the one in Figure 4, you&rsquo;re off to a good start, but you&rsquo;re not done yet. Your complex report has one significant problem: the page numbers are out of whack. Suppose the cover page is (duh) one page. Then the next report is three pages. Then two more pages, and finally four more pages. Your overall report would then be 1 + 3 + 2 + 4 = 10 pages. But if you show page numbers on the reports themselves, they won&rsquo;t count properly. FileMaker numbers each page starting at one for each Save Records as PDF step, so you wind up with page numbers like this: 1, 1, 2, 3, 1, 2, 1, 2, 3, 4. Chances are that&rsquo;s not what you had in mind.</p>
<p>To combat this problem, the Save Records as PDF step lets you tell it what page number to start with. Just select on of these steps, click the Specify button next to &ldquo;Specify options,&rdquo; then click Options. FileMaker shows you the PDF Options dialog box, which you can also see in Figure 5.</p>
<p>!!!PRODUCTION NOTE: insert COFFG05F.tiff here!!!</p>
<p>Caption: The PDF Options dialog box lets you enter all kinds of things. Most of this stuff doesn&rsquo;t do much (Title, Subject, Author, and Keywrods, for instance, just show up in an obscure info window in your PDF program). But the &ldquo;Number pages from&rdquo; box holds the key to proper page numbering.</p>
<p>You can put any number you want in the &ldquo;Number pages from&rdquo; box. So if you know your first report is just one page, you can tell the second PDF (the one you&rsquo;re appending to the first) to start numbering with page 2.</p>
<p>But usually, you don&rsquo;t know ahead of time how man pages your report will be. When that&rsquo;s the case, you have to get creative. The only way to know how many pages a printed (or PDFed) report will be is to switch to Preview mode, go to the last page, and see for yourself. You can do all this in your script, keeping the running page count in a variable (or a global field if you don&rsquo;t have FileMaker Pro Advanced).</p>
<p>Remember that you need to know the page count for a section after you&rsquo;ve added it to the PDF, so you can start the numbering on the next section properly. You need to start your page numbering at 1. So add a line like this to the top of your script:</p>
<p>Set Variable [ $page ; 1 ]</p>
<p>!!!PRODUCTION NOTE: can we put the above line in a &ldquo;code&rdquo; typeface?!!!</p>
<p>You&rsquo;ll add to this variable every time you append more pages to the PDF so it always knows how many pages you&rsquo;ve used so far. After your first Save Records as PDF script step, add these lines to your script:</p>
<p>Enter Preview Mode []
Go to Record/Request/Page [ Last ]
Set Variable [ $page ; $page + Get(PageNumber) ]
Enter Browse Mode []</p>
<p>!!!PRODUCTION NOTE: can we put the above 4 lines in a &ldquo;code&rdquo; typeface?!!!</p>
<p>These four lines of code grab the last page number from the report you just printed and add it to the $page variable.</p>
<p>Finally, select the next Save Records as PDF script step and click the Specify box next to &ldquo;Specify options&rdquo;. In the PDF Options dialog box (Figure 5), put &ldquo;$page&rdquo; (without the quotes) in the &ldquo;Number pages from&rdquo; box.</p>
<p>Repeat these for each additional section, so that every time you append, your starting page number is based on the variable, and after every section, you update the $page variable appropriately.</p>
<p>With these steps in place, your complex report now has perfect page numbers.</p>
<p>The Security Gotcha</p>
<p>As you work with PDFs, you may be tempted by the Security tab in the PDF Options dialog box. It offers up all kinds of password protection powers for your PDF. You can, for instance, require a password to print the PDF, or copy text from it. You can also restrict &ldquo;editing,&rdquo; which may sound a little intriguing since you can&rsquo;t normally edit a PDF file anyway. With the right software, though, you can edit PDF files. In fact, when FileMaker appends pages to an existing PDF file, it is editing that file. And that&rsquo;s the rub: FileMaker can&rsquo;t append pages to a PDF that doesn&rsquo;t allow editing.</p>
<p>If you turn on security restrictions for your PDF, make sure you choose either &ldquo;Inserting, deleting, and rotating pages&rdquo; or &ldquo;Any except extracting pages&rdquo; from the Editing pop-up menu for your first Save Records as PDF script step. Otherwise, FileMaker won&rsquo;t be able to append pages later (and you&rsquo;ll get an appropriate &ldquo;Access denies&rdquo; error message if you try).</p>
<p>You might be tempted to create the PDF unrestricted, then turn on the security settings as you append the last pages to the PDF. Alas, this won&rsquo;t work. The security settings are ignored when you&rsquo;re appending to a PDF that already exists. You simply can&rsquo;t restrict editing this way if you want to use the Append to PDF feature.</p>
<p>Finishing Touches</p>
<p>Your original goal was to email a nicely formatted report to the honchos every Monday. FileMaker has had the ability to email a PDF file since version 8. And you can use this feature here too. The trick is to select your options for the last Save Records as PDF step. If you turn on &ldquo;Create email with file as attachment&rdquo; (or &ldquo;Automatically open file&rdquo;) before you&rsquo;re adding the last section, you&rsquo;ll end up sending an incomplete report.</p>
<p>Using the new Append to PDF feature, you can now create stand-alone reports that are much more complex than was ever possible before. Using the techniques here, you can add as many sections as you want to the PDF. And with all the data bundled together in one file, it&rsquo;s a breeze to back it up, store it for later, print it out, or send it to someone else.</p>


</article>


</main>

<footer>
    <nav>
        
        
        
        
        
			<h2>Writing</h2>
			<menu>
			
				
				<li><a href="/weblog/">Weblog</a></li>
				
			
			</menu>
		
			<h2>Projects</h2>
			<menu>
			
				
				<li><a href="/maclanebot/">maclanebot</a></li>
				
			
				
				<li><a href="/wordplay/">Wordplay</a></li>
				
			
			</menu>
		
			<h2>About</h2>
			<menu>
			
				
				<li><a href="/me/">Contact</a></li>
				
			
				
				<li><a href="/colophon/">Colophon</a></li>
				
			
				
				<li><a href="/license/">license</a></li>
				
			
			</menu>
		
    </nav>
</footer>

</body>
</html>
