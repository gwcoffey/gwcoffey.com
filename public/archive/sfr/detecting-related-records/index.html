<!DOCTYPE html>
<html lang="en-us">
<head>
	<title>gwcoffey.com: Detecting Related Records</title>

    
    
    
    <link rel="stylesheet" href="/css/style.css">
    
	
	
	<script src="/js/main.js" defer></script>
</head>

<body>

<header>
	<h2><a rel="home" href="/">gwcoffey.com</a></h2>
</header>

<main>

<section class="archive">
	<h3>Archived Post</h3>
	
	<p>
		This post is archived from <a href="https://sixfriedrice.com/">Six Fried Rice</a>, a company and blog I used to run. Some posts have been edited slightly to fix typographical errors, and remove unnecessarily-gendered language. You can <a href="/archive/sfr/">view the full archive here</a>.
	</p>
	
</section>

<article>

<hgroup>
	<h1>Detecting Related Records</h1>
	<div class="byline">
		<address><a rel="author" href="/me">Geoff Coffey</a></address>
		/
		<time datetime="2007-09-03 00:00:00 &#43;0000 UTC">3 September 2007</time>
	</div>
</hgroup>

<p>If you have a relational database (one with several connected tables) and you do any scripting at all, you‚Äôll almost certainly ask yourself a question at some point: How can I tell if the record I‚Äôm on has related records? This article explains the scenarios you may run in to, and how <em>best</em> to deal with them.</p>
<p>Before I start pontificating, let‚Äôs set up a scenario. I have the simplest of all possible relational databases. The Relationships tab of my Manage Database window looks a lot like this:</p>
<figure><img src="rgraph.png"
         alt="Screenshot of the Relationships tab of the My Database window showing two table instances, &#34;Products&#34; and &#34;Parts&#34;. There is a join between them." width="481" height="305"/><figcaption>
            <p>The simplest of all possible relational databases has two tables and one join.</p>
        </figcaption>
</figure>

<p>I‚Äôve got a Products table, and a related Parts table. Some products have <em>no</em> parts, some have a few, and some have <em>hundreds</em>. We‚Äôll use this hypothetical example for the rest of the article.</p>
<h2 id="safely-processing-related-records">Safely Processing Related Records</h2>
<p>When you‚Äôre scripting, you often bump in to a scenario where you need to know if you have related records or not. Maybe your script is about to jump to the <em>Parts</em> related to a <em>Product</em> and do something to them:</p>
<pre tabindex="0"><code>Go to Layout [Products]
Go to Related Record [From Table: ‚ÄúParts‚Äù; Using Layout: ‚ÄúParts List‚Äù]
Go to Record/Request/Page [First]
Loop
  // do something here
  Go to Record/Request/Page [Next; Exit After Last]
End Loop
</code></pre><p>This script looks pretty solid: It goes to the set of related Parts records, jumps to the first in the list, then loops through them, doing ‚Äúsomething‚Äù to each one. But it has a pretty serious bug:</p>
<p><strong>If there are no related parts records, it will loop through all the <em>product</em> records in your found set, doing goodness only knows what to them.</strong></p>
<p>That <em>sounds</em> like a FileMaker bug at first, but it isn‚Äôt. Here‚Äôs what‚Äôs happening: Since this product has no related parts, the second line in your script (<code>Go to Related Record</code>) will <em>fail</em>. It will fail quietly, though. If you turn on FileMaker Pro Advanced 9‚Äôs Script Debugger, switch on ‚ÄúPause on Error‚Äù, and run the script, it will pause on that line and inform you that error number 101 has occurred. Error 101, as luck would have it, means ‚ÄúRecord is missing.‚Äù Since the step failed, <em>it doesn‚Äôt do anything</em>, and your script runs as though the <code>Go to Related Record</code> step weren‚Äôt there at all. Ick.</p>
<p>You can probably dream up a lot of ways to deal with this problem. Perhaps the most straight forward is to simply add a little error checking:</p>
<pre tabindex="0"><code>Go to Layout [Products]
Go to Related Record [From Table: ‚ÄúParts‚Äù; Using Layout: ‚ÄúParts List‚Äù]
If [Get(LastError) = 0]
  Go to Record/Request/Page [First]
  Loop
    // do something here
    Go to Record/Request/Page [Next; Exit After Last]
  End Loop
End If
</code></pre><p>Now, if the <code>Go to Related Record</code> step fails (for any reason), your script is smart enough to avoid the loop. I use this method in most cases because it is absolutely safe. This is especially important if the stuff in the loop is destructive (like if it changes data or‚Äîgasp‚Äîdeletes records).</p>
<h2 id="detecting-related-records-in-other-situations">Detecting Related Records in other Situations</h2>
<p>The sample above only applies to one case: Using the <code>Go to Related Record</code> script step in a script. But there are lots of other scenarios where you might want to find out if you have related records. For example, suppose you want to turn the ‚ÄúAdd Part‚Äù button red when there are no related records, so your users are irresistibly attracted to it. Or perhaps you have an unstored calculation field that shows the message, ‚ÄúNo parts have been added yet.‚Äù when there are no related records. There are lots of reasons you <em>want</em> to find out, so how do you do it?</p>
<p>A common approach is to <em>count</em> them. For instance, in a calculation field in the <code>Products</code> table, you might use a formula like this:</p>
<pre tabindex="0"><code>If ( Count(PARTS::ID) = 0 ; ‚ÄúYou need to enter some parts.‚Äù )
</code></pre><p>This formula looks at the <code>ID</code> field in all the related <code>Parts</code> records. If the field value is not empty, it counts the record, so the result of the expression <code>Count(PARTS::ID)</code> is the number of related parts records that have an ID. Since <em>every</em> record has an ID, in practice this technique counts the related <em>records</em>.</p>
<p>This formula will work swimmingly, but it has a drawback: FileMaker has to do the counting. This isn‚Äôt such a big deal. After all, FileMaker is pretty speedy. But why put it through its paces if you don‚Äôt have to?</p>
<p>Here is a version of the calculation that does <em>exactly</em> the same thing, with less work on FileMaker‚Äôs part:</p>
<pre tabindex="0"><code>If ( IsEmpty(PARTS::ID) ; ‚ÄúYou need to enter some parts.‚Äù )
</code></pre><p>It may look a little counterintuitive, but if you scratch your head for a while, I think it will start to make sense. It says, ‚ÄúIf the related Part ID field is empty, show the message.‚Äù But, you say, the ID field is <em>never</em> empty. Exactly. So if you look through the relationship at the ID field and it <em>is</em> empty, then <em>there must not be a related record</em>. Make sense?</p>
<p>Using <code>IsEmpty()</code> on a related field that is never really empty is a fast, sure-fire way to detect the absence of related records. It is faster than count, and completely fail safe.</p>
<aside class="qna">
<p class="question">FAQ: Someone told me I should use <code>IsValid()</code> for this instead. Doesn‚Äôt that work too?</p>
<p><p>The <code>IsValid()</code> function is a little-known function in FileMaker‚Äôs calculation system whose purpose in life is twofold: First, it tells you when you have bogus (ie: invalid) data in number, date, time, and timestamp fields. For instance, you might import from an Excel spreadsheet, and somebody put ‚ÄúNext Tuesday‚Äù in the Date Due column. FileMaker will import this data happily (unless you have validation to prevent it), but ‚ÄúNext Tuesday‚Äù is not a valid date. It is, as they say, <em>invalid</em>. The <code>IsValid()</code> function can also detect a missing table, but that‚Äôs not the sort of thing you typically code for.</p>
<p>For whatever reason, although the FileMaker manual says nothing about it, <code>IsValid()</code> will also return <code>false</code> when you look at a related field and their are no related records. So some people use it for this purpose. But is wasn‚Äôt <em>designed</em> to be used that way, and the folks at FileMaker can‚Äôt promise it will always work that way. What‚Äôs more there‚Äôs a (small but real) chance you might actually have invalid data in a related field. If you use <code>IsValid()</code> it <em>might</em> return false because of actual invalid data rather than no-related-records. So it isn‚Äôt completely reliable. But <code>IsEmpty</code> will <em>always</em> work so long as you stick with a field that will never be empty. And the ID field in your table is a perfect candidate for this.</p>
</p>
</aside>
<p>Happy scripting üòÑ</p>


</article>


</main>

<footer>
    <nav>
        
        
        
        
        
			<h2>Writing</h2>
			<menu>
			
				
				<li><a href="/weblog/">Weblog</a></li>
				
			
			</menu>
		
			<h2>Projects</h2>
			<menu>
			
				
				<li><a href="/maclanebot/">maclanebot</a></li>
				
			
				
				<li><a href="/wordplay/">Wordplay</a></li>
				
			
			</menu>
		
			<h2>About</h2>
			<menu>
			
				
				<li><a href="/me/">Contact</a></li>
				
			
				
				<li><a href="/colophon/">Colophon</a></li>
				
			
				
				<li><a href="/license/">license</a></li>
				
			
			</menu>
		
    </nav>
</footer>

</body>
</html>
