<!DOCTYPE html>
<html lang="en-us">
<head>
	<title>gwcoffey.com: Pop Goes the Variable</title>

    
    
    
    <link rel="stylesheet" href="/css/style.css">
    
	
	
	<script src="/js/main.js" defer></script>
</head>

<body>

<header>
	<h2><a rel="home" href="/">gwcoffey.com</a></h2>
</header>

<main>

<section class="archive">
	<h3>Archived Post</h3>
	
	<p>
		This post is archived from <a href="https://sixfriedrice.com/">Six Fried Rice</a>, a company and blog I used to run. Some posts have been edited slightly to fix typographical errors, and remove unnecessarily-gendered language. You can <a href="/archive/sfr/">view the full archive here</a>.
	</p>
	
</section>

<article>

<hgroup>
	<h1>Pop Goes the Variable</h1>
	<div class="byline">
		<address><a rel="author" href="/me">Geoff Coffey</a></address>
		/
		<time datetime="2010-08-26 00:00:00 &#43;0000 UTC">26 August 2010</time>
	</div>
</hgroup>

<p>We start our return to semi-regular writing with a small-but-awesome custom function: <code>Pop</code>. If you grew up in the American mid-west like me you might think I’m talking about [ soda | soda pop | coke | soft drinks ]. But I’m actually talking about <a href="http://en.wikipedia.org/wiki/Stack_(data_structure)">stacks</a>. In the computer science world, <code>pop</code> means to take something off the top of a list, and it is exceptionally handy to add this to your FileMaker scripting toolkit.</p>
<h2 id="looping-through-lists">Looping Through Lists</h2>
<p>Imagine you have a list of values. (I know, what a weird concept in a database).</p>
<pre tabindex="0"><code>Isabel
Sophia
Mamie
Geoff
Jesse
</code></pre><p>And you want to do something with these items in a script. Typically, for example, you might want to make a new record for each item in the list. You probably already know that FileMaker has several functions designed to make working with return-separated lists easier. For instance, suppose the list above was in a variable called <code>$names</code>. Here are some functions you might use, and their results:</p>
<pre tabindex="0"><code>GetValue($names, 3) =&gt; returns “Mamie”
LeftValues($names, 2) =&gt; returns “Isabel¶Sophia¶”
MiddleValues($names, 3, 2) =&gt; returns “Mamie¶Geoff¶”
RightValues($names, 2) =&gt; returns “Geoff¶Jesse¶”
</code></pre><p>Writing our script using these functions isn’t particularly difficult. Here’s the form we normally use:</p>
<pre tabindex="0"><code># assume $names has a return-separated list of names
# …
Loop
  Exit Loop If [ValueCount($names) = 0]
  Set Variable [$name, GetValue($names, 1)]
  New Record/Request
  Set Field [The Name Field; $name]
  # set other fields, do more with $name, or whatever*
  Set Variable [$names, MiddleValues($names, 2, 999999)]
End
</code></pre><aside class="tip">
Tip: You might wonder whey I have the <code>Exit Loop If</code> step right after the start of my loop. I do this a lot. It means my loop won’t run even once if the $names variable happens to be empty, which saves me an <code>If</code> step around the loop.
</aside>
<h2 id="pop-for-the-lazy-programmer-in-your-life">Pop: For the Lazy Programmer In Your Life</h2>
<p>We write scripts like this a lot. We pull the first item out of the variable, use it or store it, and then re-set the variable to remove that first item again. Although it is minor, this is non-ideal for a few reasons:</p>
<ol>
<li>
<p>The code is kind of strange. What does this code do? Why all those magic nines?</p>
</li>
<li>
<p>Any time you write the same couple of lines over and over again, your inner-time-saver-alert should start buzzing.</p>
</li>
<li>
<p>Call me lazy, but I’m always happy to save a few clicks and/or keystrokes.</p>
</li>
</ol>
<p>And so, we wrote <code>Pop</code>. Here it is:</p>
<pre tabindex="0"><code>Pop(variableName) :=
  Evaluate(
    “let([
      top = getValue( ” &amp; variableName &amp; ” ; 1 );
      ” &amp; variableName &amp; ” = 
      middlevalues(” &amp; variableName &amp; ” ; 2 ; 999999999999999)];

    top)”
  )
</code></pre><p>In a nutshell, this function takes the <em>name</em> of a variable as its parameter. It returns the first value in the variable <em>and</em> removes that value from the variable all in one step.</p>
<aside class="warn">
Warning: Pay attention to the previous sentence. The parameter you pass to <code>Pop</code> is the <em>name</em> of a variable, not the variable itself. You want this: <code>Pop(“$variable”)</code>, not this: <code>Pop($variable)</code>.
</aside>
<p>For the curious, I’ll explain how it works in a moment. But first let’s see it in action. We can now re-write our loop like this:</p>
<pre tabindex="0"><code>Loop
  Exit Loop If [ValueCount($names) = 0]
  Set Variable [$name, Pop(“$names”)]
  New Record/Request
  Set Field [The Name Field; $name]
  # set other fields, do more with $name, or whatever
End
</code></pre><p>Instead of using <code>GetValue</code> to get the first item in the list, and then removing it later, we do it all in one step using <code>Pop</code>. In fact, since <code>Pop</code> is a <em>function</em> instead of a script step, we can use it right inside other expressions, so we can simplify our loop even more:</p>
<pre tabindex="0"><code>Loop
  Exit Loop If [ValueCount($names) = 0]
  New Record/Request
  Set Field [The Name Field; Pop(“$names”)]
  # *set other fields, do more with $name, or whatever*
End
</code></pre><p>This time, we get the value, remove it from the variable, and put it in the field all in one step. As a function, <code>Pop</code> can be used in other places too, like inside larger expressions:</p>
<pre tabindex="0"><code>Substitute(
  $something;
  [Pop(“$to_remove”); “”];
  [Pop(“$to_remove”); “”];
  [Pop(“$to_remove”); “”]
)
</code></pre><p>Or in recursive custom functions:</p>
<pre tabindex="0"><code>If (
  ValueCount($whatever) = 0; 
  “”; 
  Pop(“$whatever”) &amp; AmazingFunction
)
</code></pre><p>It is often really handy to be able to combine fetching and removing into one tiny expression.</p>
<h2 id="how-it-works">How It Works</h2>
<p>The <code>Pop</code> function uses an oft-overlooked FileMaker power-function called <code>Evaluate</code>. This is another one of those <em>meta</em>-features in FileMaker. (&ldquo;That was me. That was I. That was the formula of this calculation.&rdquo;) <code>Evaluate</code> lets you process calculations inside your calculations.</p>
<p>When you write a calculation, you combine functions, values, fields, and operators to produce some useful result. Normally that result is some new data to display or use in your scripts. As you no-doubt know, FileMaker’s calculation engine provides some very powerful tools to process input and produce interesting results.</p>
<p>When you use <code>Evaluate</code>, the <em>result</em> of one calculation can be a calculation formula itself. Here’s a trivial example:</p>
<pre tabindex="0"><code>Evaluate(“1 + 2”)
</code></pre><p>In this case, the parameter we’re passing to <code>Evaluate</code> is the text value “1 + 2”. Since this is a valid FileMaker calculation, <code>Evaluate</code> will, well, evaluate it, and the final result of the formula will be <code>3</code>.</p>
<p>Of course that example is silly. If I wanted to add <code>1</code> and <code>2</code> in a calculation, I’d just write it like this, and save a lot of trouble:</p>
<pre tabindex="0"><code>1 + 2
</code></pre><p>But since this is a calculation, you can get as complicated as you want:</p>
<pre tabindex="0"><code>Evaluate(
  Choose($something, “Average”, “Min”, “Max”) &amp; “(1, 2, 3)”
)
</code></pre><p>That equally-ridiculous formula will return either an average, minimum, or maximum of the values <code>1</code>, <code>2</code>, and <code>3</code> depending on the value of <code>$something</code>.</p>
<p><em>But why?! Why would I ever do that?</em></p>
<p>Well, you wouldn’t. But using those techniques, you can do all kinds of other cool things, like, oh, for instance, write <code>Pop</code>. All <code>Pop</code> does is generate a new calculation formula that looks like this:</p>
<pre tabindex="0"><code>Let(
  [
    top = GetValue($my_variable, 1);
    $my_variable = MiddleValues($my_variable, 2, 99999999)
  ];

  top
)
</code></pre><p>In other words, it makes a calculation that removes the first item from a variable and returns it. Since we don’t know the name of the variable ahead of time, we have to work the variable name into the calculation <em>using a calculation</em>. (I know, meta…). Once we’ve built this little formula, we use <code>Evaluate</code> to run it for us.</p>
<p>Easy as pie (wrapped in cake, wrapped in an enigma).</p>
<h2 id="why-would-i-ever-use-this">Why Would I Ever Use This</h2>
<p>If you’re like me, right now you’re thinking this is a lot of work for a very little payoff. It saved a line or two in my loop. But I encourage you to try it out the next time you need to process lists of values. Like all custom functions, it is easy to abstract the complicated part away in your database and never worry about it again, calling on it here and there with an easy name. And that, truth be told, is the core power of programming.</p>


</article>


</main>

<footer>
    <nav>
        
        
        
        
        
			<h2>Writing</h2>
			<menu>
			
				
				<li><a href="/weblog/">Weblog</a></li>
				
			
			</menu>
		
			<h2>Projects</h2>
			<menu>
			
				
				<li><a href="/maclanebot/">maclanebot</a></li>
				
			
				
				<li><a href="/wordplay/">Wordplay</a></li>
				
			
			</menu>
		
			<h2>About</h2>
			<menu>
			
				
				<li><a href="/me/">Contact</a></li>
				
			
				
				<li><a href="/colophon/">Colophon</a></li>
				
			
				
				<li><a href="/license/">license</a></li>
				
			
			</menu>
		
    </nav>
</footer>

</body>
</html>
